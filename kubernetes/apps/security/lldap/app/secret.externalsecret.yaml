---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: &name lldap
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: *name
    template:
      data:
        LLDAP_JWT_SECRET: '{{ index . "LLDAP_JWT_SECRET" }}'
        LLDAP_KEY_SEED: '{{ index . "LLDAP_KEY_SEED" }}'
        LLDAP_LDAP_USER_DN: '{{ index . "LLDAP_LDAP_USER_DN" }}'
        LLDAP_LDAP_USER_PASS: '{{ index . "LLDAP_LDAP_USER_PASS" }}'
        ### notification smtp settings
        LLDAP_SMTP_OPTIONS__ENABLE_PASSWORD_RESET: '{{ index . "LLDAP_SMTP_OPTIONS__ENABLE_PASSWORD_RESET" }}'
        LLDAP_SMTP_OPTIONS__FROM: '{{ index . "SECRET_SMTP_ADDRESS" }}'
        LLDAP_SMTP_OPTIONS__USER: '{{ index . "SECRET_SMTP_USER" }}'
        LLDAP_SMTP_OPTIONS__PASSWORD: '{{ index . "SECRET_SMTP_PWD" }}'
        LLDAP_SMTP_OPTIONS__SERVER: '{{ index . "SECRET_SMTP_HOST" }}'
        LLDAP_SMTP_OPTIONS__PORT: '{{ index . "SECRET_SMTP_PORT" }}'
        LLDAP_SMTP_OPTIONS__SMTP_ENCRYPTION: '{{ index . "LLDAP_SMTP_OPTIONS__SMTP_ENCRYPTION" }}'

  dataFrom:
    - extract:
        # all available properties from the key will be synced
        key: "security.lldap"
    - extract:
        key: "shared.email-secrets"
