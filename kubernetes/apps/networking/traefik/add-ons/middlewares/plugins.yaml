---
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: plugin-cf-realip-xff
  namespace: networking
spec:
  plugin:
    real-ip:
      Proxy:
        # https://github.com/Paxxs/traefik-get-real-ip/issues/6
        # proxyHeadername: proxyHeadervalue determine when rule is applied
        - proxyHeadername: Cf-Warp-Tag-Id
          proxyHeadervalue: 145b8bac-18f1-4432-b4e0-14124c72b1ab
          realIP: Cf-Connecting-Ip
          overwriteXFF: true
---
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: plugin-cf-realip-transform
  namespace: networking
spec:
  plugin:
    header-transform:
      Rules:
        # https://plugins.traefik.io/plugins/62947319108ecc83915d7789/header-transformation
        # https://github.com/tomMoulard/htransformation
        - Name: "CF-Connecting-IP X-Forwarded-For"
          Header: "X-Forwarded-For"
          HeaderPrefix: "^" # identfies we want to treat value as pointer to a header
          Sep: ","
          Values:
            - "^CF-Connecting-IP"
            - "^X-Forwarded-For"
          Type: "Set"
