---
apiVersion: v1
kind: ConfigMap
metadata:
  name: kps-values-prometheus
  namespace: monitoring
data:
  values.yaml: |
    prometheus:
      ingress:
        enabled: false

      # Service for thanos service discovery on sidecar
      thanosService:
        enabled: false
      thanosServiceMonitor:
        enabled: false

      prometheusSpec:
        replicas: 1
        replicaExternalLabelName: "replica"
        ruleSelectorNilUsesHelmValues: false
        serviceMonitorSelectorNilUsesHelmValues: false
        podMonitorSelectorNilUsesHelmValues: false
        probeSelectorNilUsesHelmValues: false
        retention: 72h
        retention_size: 2816Mi
        enableAdminAPI: true
        walCompression: true
        storageSpec:
          volumeClaimTemplate:
            spec:
              # matchLabels:
              #   app.kubernetes.io/name: prometheus
              storageClassName: local-path
              resources:
                requests:
                  storage: 3Gi
        resources:
          requests:
            memory: 4096Mi
          limits:
            memory: 8192M1 # 4096Mi

        # thanos:
        #   image: quay.io/thanos/thanos:v0.23.1
        #   version: v0.22.0
        #   objectStorageConfig:
        #     name: thanos-objstore-secret
        #     key: objstore.yml

        additionalScrapeConfigs:
          - job_name: opnsense
            honor_timestamps: true
            static_configs:
              - targets:
                  - "opnsense.${SECRET_DOMAIN}:9100"
        #   - job_name: cadvisor
        #     honor_timestamps: true
        #     static_configs:
        #       - targets:
        #           - "expanse.${SECRET_DOMAIN}:8005"
