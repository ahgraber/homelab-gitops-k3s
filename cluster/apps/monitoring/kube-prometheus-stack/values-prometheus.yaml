---
apiVersion: v1
kind: ConfigMap
metadata:
  name: kps-values-prometheus
  namespace: monitoring
data:
  values.yaml: |
    prometheus:
      ingress:
        enabled: false

      # Service for thanos service discovery on sidecar
      thanosService:
        enabled: false
      thanosServiceMonitor:
        enabled: false

      prometheusSpec:
        replicas: 1
        replicaExternalLabelName: "replica"
        ruleSelectorNilUsesHelmValues: false
        serviceMonitorSelectorNilUsesHelmValues: false
        podMonitorSelectorNilUsesHelmValues: false
        probeSelectorNilUsesHelmValues: false
        retention: 7d
        enableAdminAPI: true
        walCompression: true
        storageSpec:
          volumeClaimTemplate:
            # metadata:
            #   name: prometheus-data
            #   labels:
            #     app.kubernetes.io/instance: prometheus-prometheus
            #     app.kubernetes.io/name: prometheus
            #     operator.prometheus.io/name: prometheus-prometheus
            #     operator.prometheus.io/shard: "0"
            #     prometheus: prometheus-prometheus
            spec:
              # matchLabels:
              #   app.kubernetes.io/name: prometheus
              # volumeName: prometheus-data
              # storageClassName: csi-truenas-iscsi
              storageClassName: local-path
              resources:
                requests:
                  storage: 3Gi
        # resources:
        #   requests:
        #     memory: 3072Mi
        #   limits:
        #     memory: 4096Mi

        # thanos:
        #   image: quay.io/thanos/thanos:v0.23.1
        #   version: v0.22.0
        #   objectStorageConfig:
        #     name: thanos-objstore-secret
        #     key: objstore.yml

        additionalScrapeConfigs:
          - job_name: node-exporter
            honor_timestamps: true
            static_configs:
              - targets:
                  - "opnsense.${SECRET_DOMAIN}:9100"
        #   - job_name: "traefik"
        #     # metrics_path: /metrics
        #     static_configs:
        #       - targets: ["traefik:9100"]
        #   - job_name: cadvisor
        #     honor_timestamps: true
        #     static_configs:
        #       - targets:
        #           - "expanse.${SECRET_DOMAIN}:8005"
