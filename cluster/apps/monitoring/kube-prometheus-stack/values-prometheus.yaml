---
apiVersion: v1
kind: ConfigMap
metadata:
  name: kps-values-prometheus
  namespace: monitoring
data:
  values.yaml: |
    prometheus:
      ingress:
        enabled: false

      # Service for thanos service discovery on sidecar
      thanosService:
        enabled: false
      thanosServiceMonitor:
        enabled: false

      prometheusSpec:
        replicas: 1
        replicaExternalLabelName: "replica"
        ruleSelectorNilUsesHelmValues: false
        serviceMonitorSelectorNilUsesHelmValues: false
        podMonitorSelectorNilUsesHelmValues: false
        probeSelectorNilUsesHelmValues: false
        retention: 7d
        enableAdminAPI: true
        walCompression: true
        storageSpec:
          volumeClaimTemplate:
            # metadata:
            #   name: prometheus-data
            #   labels:
            #     app.kubernetes.io/instance: prometheus-prometheus
            #     app.kubernetes.io/name: prometheus
            #     operator.prometheus.io/name: prometheus-prometheus
            #     operator.prometheus.io/shard: "0"
            #     prometheus: prometheus-prometheus
            spec:
              # matchLabels:
              #   app.kubernetes.io/name: prometheus
              # volumeName: prometheus-data
              # storageClassName: csi-truenas-iscsi
              storageClassName: local-path
              resources:
                requests:
                  storage: 3Gi
        # resources:
        #   requests:
        #     memory: 3072Mi
        #   limits:
        #     memory: 4096Mi

        # thanos:
        #   image: quay.io/thanos/thanos:v0.23.1
        #   version: v0.22.0
        #   objectStorageConfig:
        #     name: thanos-objstore-secret
        #     key: objstore.yml

        # additionalScrapeConfigs:
        #   - job_name: "traefik"
        #     # metrics_path: /metrics
        #     static_configs:
        #       - targets: ["traefik:9100"]
        #   - job_name: cadvisor
        #     honor_timestamps: true
        #     static_configs:
        #       - targets:
        #           - "expanse.${SECRET_PRIVATE_DOMAIN}:8005"
        #   - job_name: coredns
        #     honor_timestamps: true
        #     static_configs:
        #       - targets:
        #           - "opnsense.${SECRET_PRIVATE_DOMAIN}:9153"
        #   - job_name: minio
        #     honor_timestamps: true
        #     metrics_path: /minio/v2/metrics/cluster
        #     static_configs:
        #       - targets:
        #           - "expanse.${SECRET_PRIVATE_DOMAIN}:9000"
        #   - job_name: node-exporter
        #     honor_timestamps: true
        #     static_configs:
        #       - targets:
        #           - "opnsense.${SECRET_PRIVATE_DOMAIN}:9100"
        #           - "expanse.${SECRET_PRIVATE_DOMAIN}:9100"
        #           - "valetudo.${SECRET_PRIVATE_DOMAIN}:9100"
        #           - "pikvm.${SECRET_PRIVATE_DOMAIN}:9100"
        #   - job_name: postgresql
        #     honor_timestamps: true
        #     static_configs:
        #       - targets:
        #           - "expanse.${SECRET_PRIVATE_DOMAIN}:9187"
        #   - job_name: vault
        #     metrics_path: /v1/sys/metrics
        #     params:
        #       format:
        #         - prometheus
        #     static_configs:
        #       - targets:
        #           - "expanse.${SECRET_PRIVATE_DOMAIN}:8200"
        #   - job_name: pikvm
        #     metrics_path: /api/export/prometheus/metrics
        #     basic_auth:
        #       username: "${SECRET_PIKVM_USERNAME}"
        #       password: "${SECRET_PIKVM_PASSWORD}"
        #     static_configs:
        #       - targets:
        #           - "pikvm.${SECRET_PRIVATE_DOMAIN}"
        #   - job_name: traefik
        #     honor_timestamps: true
        #     static_configs:
        #       - targets:
        #           - "expanse.${SECRET_PRIVATE_DOMAIN}:7071"
        #   - job_name: nexus
        #     metrics_path: /service/metrics/prometheus
        #     basic_auth:
        #       username: "${SECRET_NEXUS_USERNAME}"
        #       password: "${SECRET_NEXUS_PASSWORD}"
        #     static_configs:
        #       - targets:
        #           - "expanse.${SECRET_PRIVATE_DOMAIN}:8081"
