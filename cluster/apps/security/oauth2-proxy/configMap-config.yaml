apiVersion: v1
kind: ConfigMap
apiVersion: v1
metadata:
  name: configmap-oauth2-proxy
  namespace: security
kind: ConfigMap
data:
  oauth2_proxy.cfg: |
    ## OAuth2 Proxy Config File
    ## https://github.com/oauth2-proxy/oauth2-proxy

    provider = oidc
    provider-display-name = "Authentik"
    login-url = "https://auth.${SECRET_DOMAIN}/application/o/authorize/"
    oidc-issuer-url = "https://auth.${SECRET_DOMAIN}/application/o/k8s/"
    oidc-jwks-url = "https://auth.${SECRET_DOMAIN}/application/o/k8s/jwks/"
    redirect-url = "http://oauth2.${SECRET_DOMAIN}/oauth2/callback"
    cookie_secure = false
    reverse_proxy = true
    email_domains = [ "*" ]
    upstreams = [ "file:///dev/null" ]
    pass_access_token = true
    pass_authorization_header = true
    set_authorization_header = true
    set_xauthrequest = true
    pass_user_headers = true
    cookie_domain = ".${SECRET_DOMAIN}"
    whitelist_domains= [ ".${SECRET_DOMAIN}" ]